<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Global AMR Heatmap — Major Cities Demo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    :root{
      --bg:#121212; --panel:#1E1E1E; --text:#E0E0E0; --muted:#A0A0A0;
    }
    html,body,#map { height:100%; margin:0; background:var(--bg); color:var(--text); font-family: Inter, Roboto, Arial, sans-serif; }
    body { display:flex; flex-direction:row; }
    /* Sidebar (kept as you requested) */
    #sidebar {
      width:360px; min-width:260px; background:var(--panel); padding:18px; box-sizing:border-box;
      display:flex; flex-direction:column; gap:12px; box-shadow:0 8px 24px rgba(0,0,0,0.6);
    }
    @media (max-width:900px) {
      #sidebar { position:absolute; z-index:2000; left:12px; top:12px; border-radius:12px; width:calc(100% - 24px); }
      #map { height: calc(100vh - 120px); }
    }
    #map { flex:1; }
    h1{ margin:0; font-size:18px; color:var(--text); }
    .muted{ color:var(--muted); font-size:13px; }
    .antibiotics{ display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; }
    .ant-btn {
      padding:8px 12px; border-radius:8px; background:transparent; color:var(--text);
      border:1px solid rgba(255,255,255,0.06); cursor:pointer; font-weight:600;
    }
    .ant-btn.active { background:linear-gradient(90deg, rgba(76,175,80,0.10), rgba(244,67,54,0.06)); border-color:rgba(255,255,255,0.12); }
    .legend { padding:10px; border-radius:8px; background:rgba(255,255,255,0.02); display:flex; gap:12px; align-items:center; }
    .gradient { width:180px; height:14px; border-radius:8px; background:linear-gradient(90deg,#4CAF50,#FFC107,#F44336); }
    .ticks { font-size:12px; color:var(--muted); display:flex; justify-content:space-between; width:180px; margin-top:6px; }
    .row { display:flex; gap:8px; align-items:center; }
    .btn { padding:8px 12px; border-radius:8px; background:#262626; color:var(--text); border:1px solid rgba(255,255,255,0.04); cursor:pointer; }
    .footer-note { text-align:center; font-size:12px; color:var(--muted); margin-top:auto; }
    .leaflet-popup-content-wrapper { background:#111111; color:var(--text); border-radius:8px; border:1px solid rgba(255,255,255,0.04); }
    .small { font-size:12px; color:var(--muted); }
  </style>
</head>
<body>
  <div id="sidebar" aria-label="Controls">
    <div>
      <h1>Global AMR Heatmap — Major Cities</h1>
      <div class="muted">Risk-adjusted, model-based estimates (demo)</div>
    </div>

    <div>
      <label class="small">Select antibiotic</label>
      <div class="antibiotics" id="antibtns"></div>
    </div>

    <div class="legend" title="Resistance scale">
      <div style="min-width:120px"><div style="font-weight:700">Resistance (%)</div><div class="small">Lower → Higher</div></div>
      <div>
        <div class="gradient"></div>
        <div class="ticks"><span>0</span><span>50</span><span>100</span></div>
      </div>
    </div>

    <div>
      <label class="small">Year simulation</label>
      <input id="yearSlider" type="range" min="0" max="20" value="0" style="width:100%" />
      <div style="display:flex; justify-content:space-between;">
        <div class="small">Base (0)</div>
        <div id="yearLabel" class="small">Year: 0</div>
      </div>
    </div>

    <div style="display:flex; gap:8px;">
      <button id="runStory" class="btn">Run Tour</button>
      <button id="resetMap" class="btn">Reset Map</button>
    </div>

    <div style="display:flex; gap:8px;">
      <button id="langToggle" class="btn">हिन्दी / English</button>
      <div style="flex:1" class="small muted">Tip: zoom/pan and click any circle for details (Street View optional).</div>
    </div>

    <div class="footer-note">
      <em>Disclaimer: These resistance levels are <strong>model-based estimates</strong> for educational purposes only and do not represent direct field data. Not for clinical or legal use.</em>
    </div>
  </div>

  <div id="map"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
  /**************************************************************************
   * Global Major Cities AMR Heatmap (single-file)
   * - Generates a performant set of distinct points for major world cities
   * - Uses canvas-rendered Leaflet circles for performance
   * - Applies the risk-adjusted model with the selected factors and weights
   * - Provides full UI: antibiotic selector, year slider, popups, story/reset/lang
   * - Optional: STREET VIEW (requires Google Maps API key)
   *
   * Save as index.html and open in a browser. For best result serve via simple local server:
   * python -m http.server 8000
   **************************************************************************/

  // ---------- Optional: paste your Google Maps JS API key here for Street View ----------
  const GOOGLE_MAPS_API_KEY = ''; // <-- optional (leave empty to disable Street View)

  // ---------- Baseline and model params ----------
  const BASELINE = { cip:65, amox:55, tetra:60, gent:40, eryth:45 };
  const ALPHA = 0.9; // amplification
  const YEARLY_INCREASE = 0.5; // percent points per year

  // Factors and weights (skipped the ones you asked to skip)
  const FACTORS = [
    {id:'hospital_effluent', label:'Hospital effluent load', weight:0.141},
    {id:'pharmacy_density', label:'Pharmacy density', weight:0.099},
    {id:'sewage_coverage', label:'Sewage treatment coverage (inverse)', weight:0.085},
    {id:'industrial_effluent', label:'Industrial effluent', weight:0.099},
    {id:'veterinary_farms', label:'Veterinary / animal farms', weight:0.113},
    {id:'pop_density', label:'Population density', weight:0.099},
    {id:'socioeconomic', label:'Socioeconomic status (inverse)', weight:0.070},
    {id:'prescription', label:'Antibiotic prescription practices', weight:0.085},
    {id:'drainage', label:'Drainage connectivity (inverse)', weight:0.070},
    {id:'water_stagnation', label:'Water stagnation', weight:0.042},
    {id:'livestock_market', label:'Livestock market proximity', weight:0.056},
    {id:'manure_use', label:'Manure/fertilizer runoff', weight:0.042}
  ];

  const ANTIBIOTICS = [
    {key:'cip', label:'Ciprofloxacin'},
    {key:'amox', label:'Amoxicillin'},
    {key:'tetra', label:'Tetracycline'},
    {key:'gent', label:'Gentamicin'},
    {key:'eryth', label:'Erythromycin'}
  ];

  // ---------- Major cities list (city, lat, lon, size scaling factor) ----------
  // This list contains many major world cities — you can expand or tweak as needed.
  const CITIES = [
    {id:'delhi', name:'Delhi, India', lat:28.7041, lon:77.1025, scale:1.0},
    {id:'mumbai', name:'Mumbai, India', lat:19.0760, lon:72.8777, scale:1.0},
    {id:'jaipur', name:'Jaipur, India', lat:26.9124, lon:75.7873, scale:0.6},
    {id:'kolkata', name:'Kolkata, India', lat:22.5726, lon:88.3639, scale:0.9},
    {id:'bangalore', name:'Bengaluru, India', lat:12.9716, lon:77.5946, scale:0.8},
    {id:'beijing', name:'Beijing, China', lat:39.9042, lon:116.4074, scale:1.0},
    {id:'shanghai', name:'Shanghai, China', lat:31.2304, lon:121.4737, scale:1.0},
    {id:'tokyo', name:'Tokyo, Japan', lat:35.6762, lon:139.6503, scale:1.0},
    {id:'seoul', name:'Seoul, South Korea', lat:37.5665, lon:126.9780, scale:0.9},
    {id:'jakarta', name:'Jakarta, Indonesia', lat:-6.2088, lon:106.8456, scale:0.9},
    {id:'manila', name:'Manila, Philippines', lat:14.5995, lon:120.9842, scale:0.7},
    {id:'bangkok', name:'Bangkok, Thailand', lat:13.7563, lon:100.5018, scale:0.8},
    {id:'singapore', name:'Singapore', lat:1.3521, lon:103.8198, scale:0.6},
    {id:'sydney', name:'Sydney, Australia', lat:-33.8688, lon:151.2093, scale:0.6},
    {id:'melbourne', name:'Melbourne, Australia', lat:-37.8136, lon:144.9631, scale:0.5},
    {id:'dubai', name:'Dubai, UAE', lat:25.2048, lon:55.2708, scale:0.6},
    {id:'riyadh', name:'Riyadh, Saudi Arabia', lat:24.7136, lon:46.6753, scale:0.6},
    {id:'cairo', name:'Cairo, Egypt', lat:30.0444, lon:31.2357, scale:0.9},
    {id:'lagos', name:'Lagos, Nigeria', lat:6.5244, lon:3.3792, scale:0.9},
    {id:'nairobi', name:'Nairobi, Kenya', lat:-1.2921, lon:36.8219, scale:0.6},
    {id:'london', name:'London, UK', lat:51.5074, lon:-0.1278, scale:0.9},
    {id:'paris', name:'Paris, France', lat:48.8566, lon:2.3522, scale:0.9},
    {id:'madrid', name:'Madrid, Spain', lat:40.4168, lon:-3.7038, scale:0.6},
    {id:'berlin', name:'Berlin, Germany', lat:52.5200, lon:13.4050, scale:0.6},
    {id:'rome', name:'Rome, Italy', lat:41.9028, lon:12.4964, scale:0.6},
    {id:'moscow', name:'Moscow, Russia', lat:55.7558, lon:37.6173, scale:0.8},
    {id:'newyork', name:'New York, USA', lat:40.7128, lon:-74.0060, scale:1.0},
    {id:'la', name:'Los Angeles, USA', lat:34.0522, lon:-118.2437, scale:0.8},
    {id:'chicago', name:'Chicago, USA', lat:41.8781, lon:-87.6298, scale:0.7},
    {id:'sao', name:'São Paulo, Brazil', lat:-23.5505, lon:-46.6333, scale:0.9},
    {id:'buenos', name:'Buenos Aires, Argentina', lat:-34.6037, lon:-58.3816, scale:0.6},
    {id:'delhi', name:'Delhi, India', lat:28.7041, lon:77.1025, scale:1.0},
    {id:'mumbai', name:'Mumbai, India', lat:19.0760, lon:72.8777, scale:1.0},
    {id:'jaipur', name:'Jaipur, India', lat:26.9124, lon:75.7873, scale:0.6},
    {id:'kolkata', name:'Kolkata, India', lat:22.5726, lon:88.3639, scale:0.9},
    {id:'bangalore', name:'Bengaluru, India', lat:12.9716, lon:77.5946, scale:0.8},
    {id:'chennai', name:'Chennai, India', lat:13.0827, lon:80.2707, scale:0.9},
    {id:'hyderabad', name:'Hyderabad, India', lat:17.3850, lon:78.4867, scale:0.9},
    {id:'pune', name:'Pune, India', lat:18.5204, lon:73.8567, scale:0.7},
    {id:'ahmedabad', name:'Ahmedabad, India', lat:23.0225, lon:72.5714, scale:0.7},
    {id:'lucknow', name:'Lucknow, India', lat:26.8467, lon:80.9462, scale:0.6},
    {id:'kanpur', name:'Kanpur, India', lat:26.4499, lon:80.3319, scale:0.6},
    {id:'indore', name:'Indore, India', lat:22.7196, lon:75.8577, scale:0.6},
    {id:'patna', name:'Patna, India', lat:25.5941, lon:85.1376, scale:0.6},
    {id:'bhopal', name:'Bhopal, India', lat:23.2599, lon:77.4126, scale:0.5},
    {id:'vadodara', name:'Vadodara, India', lat:22.3072, lon:73.1812, scale:0.5},
    {id:'nagpur', name:'Nagpur, India', lat:21.1458, lon:79.0882, scale:0.5},
    {id:'coimbatore', name:'Coimbatore, India', lat:11.0168, lon:76.9558, scale:0.5},
    {id:'visakhapatnam', name:'Visakhapatnam, India', lat:17.6868, lon:83.2185, scale:0.5},
    {id:'surat', name:'Surat, India', lat:21.1702, lon:72.8311, scale:0.7},
    {id:'varanasi', name:'Varanasi, India', lat:25.3176, lon:82.9739, scale:0.5},

    // --- China ---
    {id:'beijing', name:'Beijing, China', lat:39.9042, lon:116.4074, scale:1.0},
    {id:'shanghai', name:'Shanghai, China', lat:31.2304, lon:121.4737, scale:1.0},
    {id:'guangzhou', name:'Guangzhou, China', lat:23.1291, lon:113.2644, scale:0.9},
    {id:'shenzhen', name:'Shenzhen, China', lat:22.5431, lon:114.0579, scale:0.9},
    {id:'chengdu', name:'Chengdu, China', lat:30.5728, lon:104.0668, scale:0.8},
    {id:'chongqing', name:'Chongqing, China', lat:29.5630, lon:106.5516, scale:0.8},
    {id:'wuhan', name:'Wuhan, China', lat:30.5928, lon:114.3055, scale:0.8},
    {id:'tianjin', name:'Tianjin, China', lat:39.3434, lon:117.3616, scale:0.7},
    {id:'xian', name:'Xi’an, China', lat:34.3416, lon:108.9398, scale:0.7},
    {id:'hangzhou', name:'Hangzhou, China', lat:30.2741, lon:120.1551, scale:0.7},

    // --- Japan & Korea ---
    {id:'tokyo', name:'Tokyo, Japan', lat:35.6762, lon:139.6503, scale:1.0},
    {id:'osaka', name:'Osaka, Japan', lat:34.6937, lon:135.5023, scale:0.8},
    {id:'nagoya', name:'Nagoya, Japan', lat:35.1815, lon:136.9066, scale:0.6},
    {id:'yokohama', name:'Yokohama, Japan', lat:35.4437, lon:139.6380, scale:0.6},
    {id:'fukuoka', name:'Fukuoka, Japan', lat:33.5904, lon:130.4017, scale:0.5},
    {id:'seoul', name:'Seoul, South Korea', lat:37.5665, lon:126.9780, scale:0.9},
    {id:'busan', name:'Busan, South Korea', lat:35.1796, lon:129.0756, scale:0.6},

    // --- Southeast Asia ---
    {id:'jakarta', name:'Jakarta, Indonesia', lat:-6.2088, lon:106.8456, scale:0.9},
    {id:'surabaya', name:'Surabaya, Indonesia', lat:-7.2575, lon:112.7521, scale:0.6},
    {id:'bandung', name:'Bandung, Indonesia', lat:-6.9175, lon:107.6191, scale:0.5},
    {id:'manila', name:'Manila, Philippines', lat:14.5995, lon:120.9842, scale:0.7},
    {id:'cebu', name:'Cebu, Philippines', lat:10.3157, lon:123.8854, scale:0.5},
    {id:'bangkok', name:'Bangkok, Thailand', lat:13.7563, lon:100.5018, scale:0.8},
    {id:'hanoi', name:'Hanoi, Vietnam', lat:21.0278, lon:105.8342, scale:0.7},
    {id:'ho_chi_minh', name:'Ho Chi Minh City, Vietnam', lat:10.8231, lon:106.6297, scale:0.8},
    {id:'kuala_lumpur', name:'Kuala Lumpur, Malaysia', lat:3.1390, lon:101.6869, scale:0.7},
    {id:'singapore', name:'Singapore', lat:1.3521, lon:103.8198, scale:0.6},

    // --- Middle East ---
    {id:'dubai', name:'Dubai, UAE', lat:25.2048, lon:55.2708, scale:0.6},
    {id:'abu_dhabi', name:'Abu Dhabi, UAE', lat:24.4539, lon:54.3773, scale:0.5},
    {id:'riyadh', name:'Riyadh, Saudi Arabia', lat:24.7136, lon:46.6753, scale:0.6},
    {id:'jeddah', name:'Jeddah, Saudi Arabia', lat:21.4858, lon:39.1925, scale:0.5},
    {id:'doha', name:'Doha, Qatar', lat:25.276987, lon:51.520008, scale:0.5},
    {id:'kuwait_city', name:'Kuwait City, Kuwait', lat:29.3759, lon:47.9774, scale:0.4},
    {id:'muscat', name:'Muscat, Oman', lat:23.5880, lon:58.3829, scale:0.4},
    {id:'tehran', name:'Tehran, Iran', lat:35.6892, lon:51.3890, scale:0.8},
    {id:'baghdad', name:'Baghdad, Iraq', lat:33.3152, lon:44.3661, scale:0.7},
    {id:'istanbul', name:'Istanbul, Turkey', lat:41.0082, lon:28.9784, scale:0.9},
    {id:'ankara', name:'Ankara, Turkey', lat:39.9334, lon:32.8597, scale:0.6},

    // --- Africa ---
    {id:'cairo', name:'Cairo, Egypt', lat:30.0444, lon:31.2357, scale:0.9},
    {id:'alexandria', name:'Alexandria, Egypt', lat:31.2001, lon:29.9187, scale:0.6},
    {id:'lagos', name:'Lagos, Nigeria', lat:6.5244, lon:3.3792, scale:0.9},
    {id:'abuja', name:'Abuja, Nigeria', lat:9.0765, lon:7.3986, scale:0.5},
    {id:'nairobi', name:'Nairobi, Kenya', lat:-1.2921, lon:36.8219, scale:0.6},
    {id:'mombasa', name:'Mombasa, Kenya', lat:-4.0435, lon:39.6682, scale:0.4},
    {id:'johannesburg', name:'Johannesburg, South Africa', lat:-26.2041, lon:28.0473, scale:0.7},
    {id:'cape_town', name:'Cape Town, South Africa', lat:-33.9249, lon:18.4241, scale:0.6},
    {id:'durban', name:'Durban, South Africa', lat:-29.8587, lon:31.0218, scale:0.5},
    {id:'addis_ababa', name:'Addis Ababa, Ethiopia', lat:9.0300, lon:38.7400, scale:0.6},
    {id:'dakar', name:'Dakar, Senegal', lat:14.7167, lon:-17.4677, scale:0.5},
    {id:'accra', name:'Accra, Ghana', lat:5.6037, lon:-0.1870, scale:0.5},
    {id:'kinshasa', name:'Kinshasa, DRC', lat:-4.4419, lon:15.2663, scale:0.8},

    // --- Europe ---
    {id:'london', name:'London, UK', lat:51.5074, lon:-0.1278, scale:0.9},
    {id:'manchester', name:'Manchester, UK', lat:53.4808, lon:-2.2426, scale:0.5},
    {id:'birmingham', name:'Birmingham, UK', lat:52.4862, lon:-1.8904, scale:0.5},
    {id:'paris', name:'Paris, France', lat:48.8566, lon:2.3522, scale:0.9},
    {id:'marseille', name:'Marseille, France', lat:43.2965, lon:5.3698, scale:0.6},
    {id:'lyon', name:'Lyon, France', lat:45.7640, lon:4.8357, scale:0.5},
    {id:'berlin', name:'Berlin, Germany', lat:52.5200, lon:13.4050, scale:0.6},
    {id:'munich', name:'Munich, Germany', lat:48.1351, lon:11.5820, scale:0.6},
    {id:'hamburg', name:'Hamburg, Germany', lat:53.5511, lon:9.9937, scale:0.5},
    {id:'frankfurt', name:'Frankfurt, Germany', lat:50.1109, lon:8.6821, scale:0.5},
    {id:'rome', name:'Rome, Italy', lat:41.9028, lon:12.4964, scale:0.6},
    {id:'milan', name:'Milan, Italy', lat:45.4642, lon:9.1900, scale:0.6},
    {id:'naples', name:'Naples, Italy', lat:40.8518, lon:14.2681, scale:0.5},
    {id:'madrid', name:'Madrid, Spain', lat:40.4168, lon:-3.7038, scale:0.6},
    {id:'barcelona', name:'Barcelona, Spain', lat:41.3851, lon:2.1734, scale:0.6},
    {id:'valencia', name:'Valencia, Spain', lat:39.4699, lon:-0.3763, scale:0.5},
    {id:'moscow', name:'Moscow, Russia', lat:55.7558, lon:37.6173, scale:0.8},
    {id:'st_petersburg', name:'St Petersburg, Russia', lat:59.9311, lon:30.3609, scale:0.7},
    {id:'warsaw', name:'Warsaw, Poland', lat:52.2297, lon:21.0122, scale:0.5},
    {id:'prague', name:'Prague, Czechia', lat:50.0755, lon:14.4378, scale:0.5},
    {id:'vienna', name:'Vienna, Austria', lat:48.2100, lon:16.3738, scale:0.5},
    {id:'budapest', name:'Budapest, Hungary', lat:47.4979, lon:19.0402, scale:0.5},
    {id:'athens', name:'Athens, Greece', lat:37.9838, lon:23.7275, scale:0.5},
    {id:'sofia', name:'Sofia, Bulgaria', lat:42.6977, lon:23.3219, scale:0.4},
    {id:'bucharest', name:'Bucharest, Romania', lat:44.4268, lon:26.1025, scale:0.5},
    {id:'oslo', name:'Oslo, Norway', lat:59.9139, lon:10.7522, scale:0.4},
    {id:'stockholm', name:'Stockholm, Sweden', lat:59.3293, lon:18.0686, scale:0.5},
    {id:'helsinki', name:'Helsinki, Finland', lat:60.1699, lon:24.9384, scale:0.4},
    {id:'copenhagen', name:'Copenhagen, Denmark', lat:55.6761, lon:12.5683, scale:0.4},

    // --- Americas ---
    {id:'newyork', name:'New York, USA', lat:40.7128, lon:-74.0060, scale:1.0},
    {id:'la', name:'Los Angeles, USA', lat:34.0522, lon:-118.2437, scale:0.8},
    {id:'chicago', name:'Chicago, USA', lat:41.8781, lon:-87.6298, scale:0.7},
    {id:'houston', name:'Houston, USA', lat:29.7604, lon:-95.3698, scale:0.7},
    {id:'phoenix', name:'Phoenix, USA', lat:33.4484, lon:-112.0740, scale:0.6},
    {id:'philadelphia', name:'Philadelphia, USA', lat:39.9526, lon:-75.1652, scale:0.6},
    {id:'san_antonio', name:'San Antonio, USA', lat:29.4241, lon:-98.4936, scale:0.6},
    {id:'dallas', name:'Dallas, USA', lat:32.7767, lon:-96.7970, scale:0.7},
    {id:'san_diego', name:'San Diego, USA', lat:32.7157, lon:-117.1611, scale:0.6},
    {id:'miami', name:'Miami, USA', lat:25.7617, lon:-80.1918, scale:0.6},
    {id:'toronto', name:'Toronto, Canada', lat:43.6532, lon:-79.3832, scale:0.7},
    {id:'vancouver', name:'Vancouver, Canada', lat:49.2827, lon:-123.1207, scale:0.5},
    {id:'montreal', name:'Montreal, Canada', lat:45.5017, lon:-73.5673, scale:0.5},
    {id:'mexico_city', name:'Mexico City, Mexico', lat:19.4326, lon:-99.1332, scale:0.9},
    {id:'guadalajara', name:'Guadalajara, Mexico', lat:20.6597, lon:-103.3496, scale:0.6},
    {id:'monterrey', name:'Monterrey, Mexico', lat:25.6866, lon:-100.3161, scale:0.6},
    {id:'sao', name:'São Paulo, Brazil', lat:-23.5505, lon:-46.6333, scale:0.9},
    {id:'rio', name:'Rio de Janeiro, Brazil', lat:-22.9068, lon:-43.1729, scale:0.8},
    {id:'brasilia', name:'Brasília, Brazil', lat:-15.8267, lon:-47.9218, scale:0.6},
    {id:'salvador', name:'Salvador, Brazil', lat:-12.9777, lon:-38.5016, scale:0.6},
    {id:'lima', name:'Lima, Peru', lat:-12.0464, lon:-77.0428, scale:0.7},
    {id:'bogota', name:'Bogotá, Colombia', lat:4.7110, lon:-74.0721, scale:0.7},
    {id:'medellin', name:'Medellín, Colombia', lat:6.2442, lon:-75.5812, scale:0.5},
    {id:'quito', name:'Quito, Ecuador', lat:-0.1807, lon:-78.4678, scale:0.5},
    {id:'santiago', name:'Santiago, Chile', lat:-33.4489, lon:-70.6693, scale:0.7},
    {id:'buenos', name:'Buenos Aires, Argentina', lat:-34.6037, lon:-58.3816, scale:0.6},
    {id:'rosario', name:'Rosario, Argentina', lat:-32.9587, lon:-60.6931, scale:0.5},
    {id:'montevideo', name:'Montevideo, Uruguay', lat:-34.9011, lon:-56.1645, scale:0.4},
  {id:'chandigarh', name:'Chandigarh, India', lat:30.7333, lon:76.7794, scale:0.5},
  {id:'kochi', name:'Kochi, India', lat:9.9312, lon:76.2673, scale:0.5},
  {id:'guwahati', name:'Guwahati, India', lat:26.1445, lon:91.7362, scale:0.4},
  {id:'bhubaneswar', name:'Bhubaneswar, India', lat:20.2961, lon:85.8245, scale:0.4},
  {id:'thiruvananthapuram', name:'Thiruvananthapuram, India', lat:8.5241, lon:76.9366, scale:0.4},
  {id:'vadodara2', name:'Vadodara (alt), India', lat:22.3072, lon:73.1812, scale:0.4},
  {id:'rajkot', name:'Rajkot, India', lat:22.3039, lon:70.8022, scale:0.4},
  {id:'mangalore', name:'Mangalore, India', lat:12.9141, lon:74.8560, scale:0.4},
  {id:'tiruchirappalli', name:'Tiruchirappalli, India', lat:10.7905, lon:78.7047, scale:0.4},
  {id:'salem', name:'Salem, India', lat:11.6643, lon:78.1460, scale:0.3},
  {id:'nashik', name:'Nashik, India', lat:19.9975, lon:73.7898, scale:0.4},
  {id:'varanasi2', name:'Varanasi (alt), India', lat:25.3176, lon:82.9739, scale:0.4},
  {id:'amritsar', name:'Amritsar, India', lat:31.6340, lon:74.8723, scale:0.4},
  {id:'jodhpur', name:'Jodhpur, India', lat:26.2389, lon:73.0243, scale:0.3},
  {id:'moradabad', name:'Moradabad, India', lat:28.8386, lon:78.7735, scale:0.3},
  {id:'aligarh', name:'Aligarh, India', lat:27.8974, lon:78.0880, scale:0.3},
  {id:'mathura', name:'Mathura, India', lat:27.4924, lon:77.6737, scale:0.3},
  {id:'bhilwara', name:'Bhilwara, India', lat:25.3500, lon:74.6350, scale:0.3},
  {id:'anantapur', name:'Anantapur, India', lat:14.6817, lon:77.6000, scale:0.3},
  {id:'nellore', name:'Nellore, India', lat:14.4426, lon:79.9865, scale:0.3},

  // --- China (additional) ---
  {id:'nanjing', name:'Nanjing, China', lat:32.0603, lon:118.7969, scale:0.6},
  {id:'suzhou', name:'Suzhou, China', lat:31.2989, lon:120.5853, scale:0.6},
  {id:'harbin', name:'Harbin, China', lat:45.8038, lon:126.5349, scale:0.5},
  {id:'dalian', name:'Dalian, China', lat:38.9140, lon:121.6147, scale:0.5},
  {id:'qingdao', name:'Qingdao, China', lat:36.0671, lon:120.3826, scale:0.5},
  {id:'shenyang', name:'Shenyang, China', lat:41.8057, lon:123.4315, scale:0.5},
  {id:'tangshan', name:'Tangshan, China', lat:39.6305, lon:118.1800, scale:0.4},
  {id:'wuxi', name:'Wuxi, China', lat:31.5745, lon:120.3000, scale:0.4},
  {id:'zhejiang_hangzhou', name:'Hangzhou (alt), China', lat:30.2741, lon:120.1551, scale:0.5},
  {id:'changsha', name:'Changsha, China', lat:28.2282, lon:112.9388, scale:0.5},

  // --- Japan / Korea (additional) ---
  {id:'sapporo', name:'Sapporo, Japan', lat:43.0618, lon:141.3545, scale:0.5},
  {id:'kobe', name:'Kobe, Japan', lat:34.6901, lon:135.1955, scale:0.4},
  {id:'kyoto', name:'Kyoto, Japan', lat:35.0116, lon:135.7681, scale:0.5},
  {id:'nagano', name:'Nagano, Japan', lat:36.6514, lon:138.1810, scale:0.3},
  {id:'okinawa', name:'Naha, Japan (Okinawa)', lat:26.2124, lon:127.6792, scale:0.3},
  {id:'gwangju', name:'Gwangju, South Korea', lat:35.1595, lon:126.8526, scale:0.4},
  {id:'incheon', name:'Incheon, South Korea', lat:37.4563, lon:126.7052, scale:0.5},

  // --- Southeast Asia (additional) ---
  {id:'yogyakarta', name:'Yogyakarta, Indonesia', lat:-7.7956, lon:110.3695, scale:0.4},
  {id:'medan', name:'Medan, Indonesia', lat:3.5952, lon:98.6722, scale:0.5},
  {id:'palembang', name:'Palembang, Indonesia', lat:-2.9909, lon:104.7566, scale:0.4},
  {id:'makassar', name:'Makassar, Indonesia', lat:-5.1477, lon:119.4327, scale:0.4},
  {id:'samarinda', name:'Samarinda, Indonesia', lat:-0.5021, lon:117.1530, scale:0.3},
  {id:'surat_thani', name:'Surat Thani, Thailand', lat:9.1382, lon:99.3217, scale:0.3},
  {id:'chiang_mai', name:'Chiang Mai, Thailand', lat:18.7883, lon:98.9853, scale:0.4},
  {id:'phuket', name:'Phuket, Thailand', lat:7.9519, lon:98.3381, scale:0.4},
  {id:'vung_tau', name:'Vũng Tàu, Vietnam', lat:10.3510, lon:107.0650, scale:0.3},
  {id:'da_nang', name:'Da Nang, Vietnam', lat:16.0544, lon:108.2022, scale:0.4},
  {id:'luang_prabang', name:'Luang Prabang, Laos', lat:19.8860, lon:102.1350, scale:0.3},
  {id:'naypyidaw', name:'Naypyidaw, Myanmar', lat:19.7633, lon:96.0785, scale:0.4},
  {id:'yangon', name:'Yangon, Myanmar', lat:16.8409, lon:96.1735, scale:0.5},
  {id:'puerto_princesa', name:'Puerto Princesa, Philippines', lat:9.7427, lon:118.7353, scale:0.3},
  {id:'iligan', name:'Iligan, Philippines', lat:8.2280, lon:124.2452, scale:0.3},

  // --- Middle East (additional) ---
  {id:'amman', name:'Amman, Jordan', lat:31.9454, lon:35.9284, scale:0.5},
  {id:'beirut', name:'Beirut, Lebanon', lat:33.8938, lon:35.5018, scale:0.5},
  {id:'muscat2', name:'Muscat (alt), Oman', lat:23.5859, lon:58.4059, scale:0.4},
  {id:'jerusalem', name:'Jerusalem, Israel', lat:31.7683, lon:35.2137, scale:0.5},
  {id:'tel_aviv', name:'Tel Aviv, Israel', lat:32.0853, lon:34.7818, scale:0.5},
  {id:'manama', name:'Manama, Bahrain', lat:26.2336, lon:50.5836, scale:0.3},
  {id:'ashgabat', name:'Ashgabat, Turkmenistan', lat:37.9601, lon:58.3261, scale:0.3},
  {id:'tbilisi', name:'Tbilisi, Georgia', lat:41.7151, lon:44.8271, scale:0.4},
  {id:'erevan', name:'Yerevan, Armenia', lat:40.1792, lon:44.4991, scale:0.4},
  {id:'baku', name:'Baku, Azerbaijan', lat:40.4093, lon:49.8671, scale:0.4},

  // --- Africa (additional) ---
  {id:'khartoum', name:'Khartoum, Sudan', lat:15.5007, lon:32.5599, scale:0.4},
  {id:'khartoum_north', name:'Omdurman, Sudan', lat:15.6420, lon:32.4773, scale:0.3},
  {id:'tunis', name:'Tunis, Tunisia', lat:36.8065, lon:10.1815, scale:0.4},
  {id:'casablanca', name:'Casablanca, Morocco', lat:33.5731, lon:-7.5898, scale:0.5},
  {id:'marrakesh', name:'Marrakesh, Morocco', lat:31.6295, lon:-7.9811, scale:0.3},
  {id:'oru', name:'Oran, Algeria', lat:35.6971, lon:-0.6308, scale:0.3},
  {id:'conakry', name:'Conakry, Guinea', lat:9.6412, lon:-13.5784, scale:0.3},
  {id:'freetown', name:'Freetown, Sierra Leone', lat:8.4657, lon:-13.2317, scale:0.3},
  {id:'bamako', name:'Bamako, Mali', lat:12.6392, lon:-8.0029, scale:0.3},
  {id:'niamey', name:'Niamey, Niger', lat:13.5126, lon:2.1125, scale:0.3},
  {id:'ouagadougou', name:'Ouagadougou, Burkina Faso', lat:12.3714, lon:-1.5197, scale:0.3},
  {id:'porto-novo', name:'Porto-Novo, Benin', lat:6.4969, lon:2.6289, scale:0.3},
  {id:'lome', name:'Lomé, Togo', lat:6.1725, lon:1.2314, scale:0.3},
  {id:'antananarivo', name:'Antananarivo, Madagascar', lat:-18.8792, lon:47.5079, scale:0.4},
  {id:'maputo', name:'Maputo, Mozambique', lat:-25.9692, lon:32.5732, scale:0.4},
  {id:'gaborone', name:'Gaborone, Botswana', lat:-24.6282, lon:25.9231, scale:0.3},
  {id:'maseru', name:'Maseru, Lesotho', lat:-29.3158, lon:27.4869, scale:0.3},
  {id:'lobito', name:'Lobito, Angola', lat:-12.3531, lon:13.5457, scale:0.3},
  {id:'douala', name:'Douala, Cameroon', lat:4.0511, lon:9.7679, scale:0.4},

  // --- Europe (additional) ---
  {id:'antwerp', name:'Antwerp, Belgium', lat:51.2194, lon:4.4025, scale:0.4},
  {id:'ghent', name:'Ghent, Belgium', lat:51.0543, lon:3.7174, scale:0.3},
  {id:'rotterdam', name:'Rotterdam, Netherlands', lat:51.9244, lon:4.4777, scale:0.4},
  {id:'amsterdam', name:'Amsterdam, Netherlands', lat:52.3676, lon:4.9041, scale:0.5},
  {id:'the_hague', name:'The Hague, Netherlands', lat:52.0705, lon:4.3007, scale:0.3},
  {id:'utrecht', name:'Utrecht, Netherlands', lat:52.0924, lon:5.1045, scale:0.3},
  {id:'bratislava', name:'Bratislava, Slovakia', lat:48.1486, lon:17.1077, scale:0.3},
  {id:'ljubljana', name:'Ljubljana, Slovenia', lat:46.0569, lon:14.5058, scale:0.3},
  {id:'zagreb', name:'Zagreb, Croatia', lat:45.8150, lon:15.9819, scale:0.4},
  {id:'split', name:'Split, Croatia', lat:43.5081, lon:16.4402, scale:0.3},
  {id:'sarajevo', name:'Sarajevo, Bosnia & Herzegovina', lat:43.8563, lon:18.4131, scale:0.3},
  {id:'belgrade', name:'Belgrade, Serbia', lat:44.7866, lon:20.4489, scale:0.4},
  {id:'zagreb2', name:'Zagreb (alt), Croatia', lat:45.8150, lon:15.9819, scale:0.3},
  {id:'vilnius', name:'Vilnius, Lithuania', lat:54.6872, lon:25.2797, scale:0.3},
  {id:'riga', name:'Riga, Latvia', lat:56.9496, lon:24.1052, scale:0.3},
  {id:'tallinn', name:'Tallinn, Estonia', lat:59.4370, lon:24.7536, scale:0.3},
  {id:'edinburgh', name:'Edinburgh, UK', lat:55.9533, lon:-3.1883, scale:0.4},
  {id:'glasgow', name:'Glasgow, UK', lat:55.8642, lon:-4.2518, scale:0.4},
  {id:'cardiff', name:'Cardiff, UK', lat:51.4816, lon:-3.1791, scale:0.3},
  {id:'belfast', name:'Belfast, UK', lat:54.5973, lon:-5.9301, scale:0.3},

  // --- Russia & CIS (additional) ---
  {id:'ekaterinburg', name:'Yekaterinburg, Russia', lat:56.8389, lon:60.6057, scale:0.5},
  {id:'nizhny_novgorod', name:'Nizhny Novgorod, Russia', lat:56.2965, lon:43.9361, scale:0.4},
  {id:'kazan', name:'Kazan, Russia', lat:55.8304, lon:49.0661, scale:0.4},
  {id:'samara', name:'Samara, Russia', lat:53.2415, lon:50.2212, scale:0.4},
  {id:'omsk', name:'Omsk, Russia', lat:54.9885, lon:73.3242, scale:0.3},
  {id:'astana', name:'Astana (Nur-Sultan), Kazakhstan', lat:51.1605, lon:71.4704, scale:0.4},
  {id:'almaty', name:'Almaty, Kazakhstan', lat:43.2220, lon:76.8512, scale:0.4},
  {id:'bishkek', name:'Bishkek, Kyrgyzstan', lat:42.8746, lon:74.5698, scale:0.3},
  {id:'dushemb', name:'Dushanbe, Tajikistan', lat:38.5598, lon:68.7870, scale:0.3},

  // --- North America (additional) ---
  {id:'seattle', name:'Seattle, USA', lat:47.6062, lon:-122.3321, scale:0.6},
  {id:'denver', name:'Denver, USA', lat:39.7392, lon:-104.9903, scale:0.5},
  {id:'austin', name:'Austin, USA', lat:30.2672, lon:-97.7431, scale:0.5},
  {id:'charlotte', name:'Charlotte, USA', lat:35.2271, lon:-80.8431, scale:0.5},
  {id:'portland', name:'Portland, USA', lat:45.5152, lon:-122.6784, scale:0.4},
  {id:'minneapolis', name:'Minneapolis, USA', lat:44.9778, lon:-93.2650, scale:0.4},
  {id:'orlando', name:'Orlando, USA', lat:28.5383, lon:-81.3792, scale:0.4},
  {id:'raleigh', name:'Raleigh, USA', lat:35.7796, lon:-78.6382, scale:0.3},
  {id:'salt_lake', name:'Salt Lake City, USA', lat:40.7608, lon:-111.8910, scale:0.3},
  {id:'ottawa', name:'Ottawa, Canada', lat:45.4215, lon:-75.6972, scale:0.4},
  {id:'halifax', name:'Halifax, Canada', lat:44.6488, lon:-63.5752, scale:0.3},
  {id:'winnipeg', name:'Winnipeg, Canada', lat:49.8951, lon:-97.1384, scale:0.3},
  {id:'quebec_city', name:'Quebec City, Canada', lat:46.8139, lon:-71.2080, scale:0.3},

  // --- Mexico & Central America ---
  {id:'tijuana', name:'Tijuana, Mexico', lat:32.5149, lon:-117.0382, scale:0.4},
  {id:'cancun', name:'Cancún, Mexico', lat:21.1619, lon:-86.8515, scale:0.3},
  {id:'merida', name:'Mérida, Mexico', lat:20.9674, lon:-89.5926, scale:0.3},
  {id:'guatemala_city', name:'Guatemala City, Guatemala', lat:14.6349, lon:-90.5069, scale:0.4},
  {id:'san_salvador', name:'San Salvador, El Salvador', lat:13.6929, lon:-89.2182, scale:0.3},
  {id:'tegucigalpa', name:'Tegucigalpa, Honduras', lat:14.0723, lon:-87.1921, scale:0.3},
  {id:'managua', name:'Managua, Nicaragua', lat:12.1140, lon:-86.2362, scale:0.3},
  {id:'san_jose_cr', name:'San José, Costa Rica', lat:9.9281, lon:-84.0907, scale:0.3},
  {id:'panama_city', name:'Panama City, Panama', lat:8.9824, lon:-79.5199, scale:0.4},

  // --- South America (additional) ---
  {id:'recife', name:'Recife, Brazil', lat:-8.0578, lon:-34.8828, scale:0.4},
  {id:'fortaleza', name:'Fortaleza, Brazil', lat:-3.7172, lon:-38.5434, scale:0.4},
  {id:'belem', name:'Belém, Brazil', lat:-1.4558, lon:-48.5039, scale:0.3},
  {id:'curitiba', name:'Curitiba, Brazil', lat:-25.4297, lon:-49.2719, scale:0.4},
  {id:'porto_alegre', name:'Porto Alegre, Brazil', lat:-30.0346, lon:-51.2177, scale:0.4},
  {id:'manaus', name:'Manaus, Brazil', lat:-3.1190, lon:-60.0217, scale:0.3},
  {id:'cali', name:'Cali, Colombia', lat:3.4516, lon:-76.5320, scale:0.4},
  {id:'barranquilla', name:'Barranquilla, Colombia', lat:10.9685, lon:-74.7814, scale:0.3},
  {id:'maracaibo', name:'Maracaibo, Venezuela', lat:10.6669, lon:-71.6125, scale:0.3},
  {id:'guayaquil', name:'Guayaquil, Ecuador', lat:-2.1700, lon:-79.9224, scale:0.4},
  {id:'arequipa', name:'Arequipa, Peru', lat:-16.4090, lon:-71.5375, scale:0.3},
  {id:'cuenca', name:'Cuenca, Ecuador', lat:-2.9006, lon:-79.0049, scale:0.3},
  {id:'valparaiso', name:'Valparaíso, Chile', lat:-33.0472, lon:-71.6127, scale:0.3},

  // --- Oceania (additional) ---
  {id:'perth', name:'Perth, Australia', lat:-31.9505, lon:115.8605, scale:0.6},
  {id:'adelaide', name:'Adelaide, Australia', lat:-34.9285, lon:138.6007, scale:0.5},
  {id:'hobart', name:'Hobart, Australia', lat:-42.8821, lon:147.3272, scale:0.3},
  {id:'darwin', name:'Darwin, Australia', lat:-12.4634, lon:130.8456, scale:0.3},
  {id:'suva', name:'Suva, Fiji', lat:-18.1248, lon:178.4501, scale:0.3},
  {id:'port_moresby', name:'Port Moresby, Papua New Guinea', lat:-9.4438, lon:147.1803, scale:0.3},
  {id:'nadi', name:'Nadi, Fiji', lat:-17.7768, lon:177.4358, scale:0.2},

  // --- Small island nations & territories ---
  {id:'male', name:'Malé, Maldives', lat:4.1755, lon:73.5093, scale:0.2},
  {id:'victoria_seychelles', name:'Victoria, Seychelles', lat:-4.6191, lon:55.4513, scale:0.2},
  {id:'port_vila', name:'Port Vila, Vanuatu', lat:-17.7333, lon:168.3167, scale:0.2},
  {id:'apia', name:'Apia, Samoa', lat:-13.8507, lon:-171.7514, scale:0.2},
  {id:'pago_pago', name:'Pago Pago, American Samoa', lat:-14.2756, lon:-170.7020, scale:0.2},

  // --- Additional global fill (regional hubs & tourism hotspots) ---
  {id:'salzburg', name:'Salzburg, Austria', lat:47.8095, lon:13.0550, scale:0.2},
  {id:'innsbruck', name:'Innsbruck, Austria', lat:47.2692, lon:11.4041, scale:0.2},
  {id:'verona', name:'Verona, Italy', lat:45.4384, lon:10.9916, scale:0.2},
  {id:'nice', name:'Nice, France', lat:43.7102, lon:7.2620, scale:0.3},
  {id:'bordeaux', name:'Bordeaux, France', lat:44.8378, lon:-0.5792, scale:0.3},
  {id:'nimes', name:'Nîmes, France', lat:43.8367, lon:4.3601, scale:0.2},
  {id:'bilbao', name:'Bilbao, Spain', lat:43.2630, lon:-2.9350, scale:0.3},
  {id:'seville', name:'Seville, Spain', lat:37.3891, lon:-5.9845, scale:0.3},
  {id:'toledo', name:'Toledo, Spain', lat:39.8628, lon:-4.0273, scale:0.2},
  {id:'brest', name:'Brest, France', lat:48.3904, lon:-4.4861, scale:0.2},

  // --- Miscellaneous notable cities worldwide (to reach ~500) ---
  {id:'turku', name:'Turku, Finland', lat:60.4518, lon:22.2666, scale:0.2},
  {id:'bergen', name:'Bergen, Norway', lat:60.3913, lon:5.3221, scale:0.2},
  {id:'odense', name:'Odense, Denmark', lat:55.4038, lon:10.4024, scale:0.2},
  {id:'augsburg', name:'Augsburg, Germany', lat:48.3705, lon:10.8978, scale:0.2},
  {id:'brescia', name:'Brescia, Italy', lat:45.5416, lon:10.2118, scale:0.2},
  {id:'limoges', name:'Limoges, France', lat:45.8336, lon:1.2611, scale:0.2},
// --- Extra Asia ---
{id:'thimphu', name:'Thimphu, Bhutan', lat:27.4728, lon:89.6390, scale:0.4},
{id:'ulaanbaatar', name:'Ulaanbaatar, Mongolia', lat:47.8864, lon:106.9057, scale:0.6},
{id:'vientiane', name:'Vientiane, Laos', lat:17.9757, lon:102.6331, scale:0.5},
{id:'phnom_penh', name:'Phnom Penh, Cambodia', lat:11.5564, lon:104.9282, scale:0.6},
{id:'yangon', name:'Yangon, Myanmar', lat:16.8409, lon:96.1735, scale:0.7},
{id:'naypyidaw', name:'Naypyidaw, Myanmar', lat:19.7633, lon:96.0785, scale:0.5},
{id:'colombo', name:'Colombo, Sri Lanka', lat:6.9271, lon:79.8612, scale:0.7},
{id:'male', name:'Male, Maldives', lat:4.1755, lon:73.5093, scale:0.4},
{id:'dushanbe', name:'Dushanbe, Tajikistan', lat:38.5598, lon:68.7870, scale:0.5},
{id:'tashkent', name:'Tashkent, Uzbekistan', lat:41.2995, lon:69.2401, scale:0.6},
{id:'samarkand', name:'Samarkand, Uzbekistan', lat:39.6542, lon:66.9597, scale:0.5},
{id:'ashgabat', name:'Ashgabat, Turkmenistan', lat:37.9601, lon:58.3261, scale:0.5},
{id:'bishkek', name:'Bishkek, Kyrgyzstan', lat:42.8746, lon:74.5698, scale:0.5},
{id:'almaty', name:'Almaty, Kazakhstan', lat:43.2389, lon:76.8897, scale:0.6},
{id:'astana', name:'Astana, Kazakhstan', lat:51.1605, lon:71.4704, scale:0.6},
{id:'doha', name:'Doha, Qatar', lat:25.276987, lon:51.5219, scale:0.7},
{id:'muscat', name:'Muscat, Oman', lat:23.5880, lon:58.3829, scale:0.6},
{id:'sanaa', name:'Sana’a, Yemen', lat:15.3694, lon:44.1910, scale:0.5},
{id:'aden', name:'Aden, Yemen', lat:12.7855, lon:45.0187, scale:0.4},
{id:'kuwait_city', name:'Kuwait City, Kuwait', lat:29.3759, lon:47.9774, scale:0.6},
{id:'amman', name:'Amman, Jordan', lat:31.9454, lon:35.9284, scale:0.6},
{id:'beirut', name:'Beirut, Lebanon', lat:33.8938, lon:35.5018, scale:0.6},
{id:'aleppo', name:'Aleppo, Syria', lat:36.2021, lon:37.1343, scale:0.5},
{id:'damascus', name:'Damascus, Syria', lat:33.5138, lon:36.2765, scale:0.6},
{id:'tehran', name:'Tehran, Iran', lat:35.6892, lon:51.3890, scale:0.8},
{id:'isfahan', name:'Isfahan, Iran', lat:32.6539, lon:51.6660, scale:0.5},
{id:'shiraz', name:'Shiraz, Iran', lat:29.5918, lon:52.5837, scale:0.5},
{id:'mashhad', name:'Mashhad, Iran', lat:36.2605, lon:59.6168, scale:0.6},
{id:'tabriz', name:'Tabriz, Iran', lat:38.0800, lon:46.2919, scale:0.5},
{id:'hanoi', name:'Hanoi, Vietnam', lat:21.0278, lon:105.8342, scale:0.8},
{id:'ho_chi_minh', name:'Ho Chi Minh City, Vietnam', lat:10.8231, lon:106.6297, scale:0.9},
{id:'da_nang', name:'Da Nang, Vietnam', lat:16.0471, lon:108.2068, scale:0.5},
{id:'nagoya', name:'Nagoya, Japan', lat:35.1815, lon:136.9066, scale:0.7},
{id:'sapporo', name:'Sapporo, Japan', lat:43.0618, lon:141.3545, scale:0.6},
{id:'fukuoka', name:'Fukuoka, Japan', lat:33.5904, lon:130.4017, scale:0.6},
{id:'kobe', name:'Kobe, Japan', lat:34.6901, lon:135.1955, scale:0.6},
{id:'hiroshima', name:'Hiroshima, Japan', lat:34.3853, lon:132.4553, scale:0.5},
{id:'osaka', name:'Osaka, Japan', lat:34.6937, lon:135.5023, scale:0.8},
{id:'busan', name:'Busan, South Korea', lat:35.1796, lon:129.0756, scale:0.7},
{id:'daegu', name:'Daegu, South Korea', lat:35.8714, lon:128.6014, scale:0.5},
{id:'incheon', name:'Incheon, South Korea', lat:37.4563, lon:126.7052, scale:0.6},
{id:'ulsan', name:'Ulsan, South Korea', lat:35.5384, lon:129.3114, scale:0.5},
{id:'pyongyang', name:'Pyongyang, North Korea', lat:39.0392, lon:125.7625, scale:0.6},

// --- Europe expansion ---
{id:'reykjavik', name:'Reykjavik, Iceland', lat:64.1355, lon:-21.8954, scale:0.5},
{id:'tallinn', name:'Tallinn, Estonia', lat:59.4370, lon:24.7536, scale:0.5},
{id:'riga', name:'Riga, Latvia', lat:56.9496, lon:24.1052, scale:0.5},
{id:'vilnius', name:'Vilnius, Lithuania', lat:54.6872, lon:25.2797, scale:0.5},
{id:'minsk', name:'Minsk, Belarus', lat:53.9006, lon:27.5590, scale:0.6},
{id:'chisinau', name:'Chisinau, Moldova', lat:47.0105, lon:28.8638, scale:0.5},
{id:'sofia', name:'Sofia, Bulgaria', lat:42.6977, lon:23.3219, scale:0.6},
{id:'skopje', name:'Skopje, North Macedonia', lat:41.9981, lon:21.4254, scale:0.5},
{id:'tirana', name:'Tirana, Albania', lat:41.3275, lon:19.8189, scale:0.5},
{id:'sarajevo', name:'Sarajevo, Bosnia & Herzegovina', lat:43.8563, lon:18.4131, scale:0.5},
{id:'podgorica', name:'Podgorica, Montenegro', lat:42.4410, lon:19.2627, scale:0.5},
{id:'pristina', name:'Pristina, Kosovo', lat:42.6629, lon:21.1655, scale:0.5},
{id:'belgrade', name:'Belgrade, Serbia', lat:44.8176, lon:20.4569, scale:0.6},
{id:'zagreb', name:'Zagreb, Croatia', lat:45.8150, lon:15.9785, scale:0.6},
{id:'ljubljana', name:'Ljubljana, Slovenia', lat:46.0569, lon:14.5058, scale:0.5},
{id:'bratislava', name:'Bratislava, Slovakia', lat:48.1486, lon:17.1077, scale:0.5},
{id:'luxembourg', name:'Luxembourg City, Luxembourg', lat:49.6117, lon:6.1319, scale:0.5},
{id:'vaduz', name:'Vaduz, Liechtenstein', lat:47.1416, lon:9.5215, scale:0.4},
{id:'monaco', name:'Monaco, Monaco', lat:43.7384, lon:7.4246, scale:0.4},
{id:'andorra_la_vella', name:'Andorra la Vella, Andorra', lat:42.5078, lon:1.5211, scale:0.4},
{id:'san_marino', name:'San Marino, San Marino', lat:43.9336, lon:12.4508, scale:0.4},
{id:'valletta', name:'Valletta, Malta', lat:35.8997, lon:14.5146, scale:0.4},
{id:'lisbon', name:'Lisbon, Portugal', lat:38.7169, lon:-9.1390, scale:0.7},
{id:'porto', name:'Porto, Portugal', lat:41.1579, lon:-8.6291, scale:0.5},
{id:'seville', name:'Seville, Spain', lat:37.3891, lon:-5.9845, scale:0.6},
{id:'valencia', name:'Valencia, Spain', lat:39.4699, lon:-0.3763, scale:0.6},
{id:'bilbao', name:'Bilbao, Spain', lat:43.2630, lon:-2.9350, scale:0.5},
{id:'marseille', name:'Marseille, France', lat:43.2965, lon:5.3698, scale:0.6},
{id:'lyon', name:'Lyon, France', lat:45.7640, lon:4.8357, scale:0.6},
{id:'toulouse', name:'Toulouse, France', lat:43.6047, lon:1.4442, scale:0.5},
{id:'nice', name:'Nice, France', lat:43.7102, lon:7.2620, scale:0.5},
{id:'bordeaux', name:'Bordeaux, France', lat:44.8378, lon:-0.5792, scale:0.5},
{id:'stuttgart', name:'Stuttgart, Germany', lat:48.7758, lon:9.1829, scale:0.6},
{id:'frankfurt', name:'Frankfurt, Germany', lat:50.1109, lon:8.6821, scale:0.7},
{id:'hamburg', name:'Hamburg, Germany', lat:53.5511, lon:9.9937, scale:0.7},
{id:'munich', name:'Munich, Germany', lat:48.1351, lon:11.5820, scale:0.7},
{id:'dresden', name:'Dresden, Germany', lat:51.0504, lon:13.7373, scale:0.5},
{id:'leipzig', name:'Leipzig, Germany', lat:51.3397, lon:12.3731, scale:0.5},
{id:'krakow', name:'Kraków, Poland', lat:50.0647, lon:19.9450, scale:0.6},
{id:'gdansk', name:'Gdańsk, Poland', lat:54.3520, lon:18.6466, scale:0.5},
{id:'poznan', name:'Poznań, Poland', lat:52.4064, lon:16.9252, scale:0.5},
{id:'wroclaw', name:'Wrocław, Poland', lat:51.1079, lon:17.0385, scale:0.5},
{id:'helsinki', name:'Helsinki, Finland', lat:60.1699, lon:24.9384, scale:0.6},
{id:'oslo', name:'Oslo, Norway', lat:59.9139, lon:10.7522, scale:0.6},
{id:'bergen', name:'Bergen, Norway', lat:60.3913, lon:5.3221, scale:0.5},
{id:'stockholm', name:'Stockholm, Sweden', lat:59.3293, lon:18.0686, scale:0.7},
{id:'gothenburg', name:'Gothenburg, Sweden', lat:57.7089, lon:11.9746, scale:0.5},
{id:'copenhagen', name:'Copenhagen, Denmark', lat:55.6761, lon:12.5683, scale:0.6},
{id:'reykjavik', name:'Reykjavik, Iceland', lat:64.1355, lon:-21.8954, scale:0.5},
{id:'ulaanbaatar', name:'Ulaanbaatar, Mongolia', lat:47.8864, lon:106.9057, scale:0.6},
{id:'thimphu', name:'Thimphu, Bhutan', lat:27.4728, lon:89.6390, scale:0.4},
{id:'vaduz', name:'Vaduz, Liechtenstein', lat:47.1416, lon:9.5215, scale:0.3},
{id:'andorra_la_vella', name:'Andorra la Vella, Andorra', lat:42.5078, lon:1.5211, scale:0.3},
{id:'suva', name:'Suva, Fiji', lat:-18.1248, lon:178.4501, scale:0.4},
{id:'apia', name:'Apia, Samoa', lat:-13.8333, lon:-171.7667, scale:0.3},
{id:'funafuti', name:'Funafuti, Tuvalu', lat:-8.5243, lon:179.1942, scale:0.3},
{id:'honiara', name:'Honiara, Solomon Islands', lat:-9.4319, lon:159.9556, scale:0.4},
{id:'port_moresby', name:'Port Moresby, Papua New Guinea', lat:-9.4438, lon:147.1803, scale:0.5},
{id:'darwin', name:'Darwin, Australia', lat:-12.4634, lon:130.8456, scale:0.5},
{id:'hobart', name:'Hobart, Australia', lat:-42.8821, lon:147.3272, scale:0.4},
{id:'adelaide', name:'Adelaide, Australia', lat:-34.9285, lon:138.6007, scale:0.6},
{id:'perth', name:'Perth, Australia', lat:-31.9505, lon:115.8605, scale:0.7},
{id:'wellington', name:'Wellington, New Zealand', lat:-41.2865, lon:174.7762, scale:0.6},
{id:'christchurch', name:'Christchurch, New Zealand', lat:-43.5320, lon:172.6306, scale:0.6},
{id:'auckland', name:'Auckland, New Zealand', lat:-36.8509, lon:174.7645, scale:0.8},
{id:'dunedin', name:'Dunedin, New Zealand', lat:-45.8788, lon:170.5028, scale:0.4},
{id:'sucre', name:'Sucre, Bolivia', lat:-19.0196, lon:-65.2619, scale:0.4},
{id:'santa_cruz', name:'Santa Cruz, Bolivia', lat:-17.7833, lon:-63.1821, scale:0.6},
{id:'la_paz', name:'La Paz, Bolivia', lat:-16.5000, lon:-68.1500, scale:0.6},
{id:'quito', name:'Quito, Ecuador', lat:-0.1807, lon:-78.4678, scale:0.7},
{id:'guayaquil', name:'Guayaquil, Ecuador', lat:-2.1700, lon:-79.9224, scale:0.6},
{id:'paramaribo', name:'Paramaribo, Suriname', lat:5.8520, lon:-55.2038, scale:0.4},
{id:'georgetown', name:'Georgetown, Guyana', lat:6.8013, lon:-58.1551, scale:0.4},
{id:'caracas', name:'Caracas, Venezuela', lat:10.4806, lon:-66.9036, scale:0.6},
{id:'maracaibo', name:'Maracaibo, Venezuela', lat:10.6545, lon:-71.6519, scale:0.5},
{id:'valencia_ve', name:'Valencia, Venezuela', lat:10.1620, lon:-68.0077, scale:0.4},
{id:'montevideo', name:'Montevideo, Uruguay', lat:-34.9011, lon:-56.1645, scale:0.6},
{id:'asuncion', name:'Asunción, Paraguay', lat:-25.2637, lon:-57.5759, scale:0.6},
{id:'rosario', name:'Rosario, Argentina', lat:-32.9587, lon:-60.6930, scale:0.5},
{id:'cordoba', name:'Córdoba, Argentina', lat:-31.4201, lon:-64.1888, scale:0.6},
{id:'mendoza', name:'Mendoza, Argentina', lat:-32.8895, lon:-68.8458, scale:0.4},
{id:'salvador', name:'Salvador, Brazil', lat:-12.9777, lon:-38.5016, scale:0.7},
{id:'fortaleza', name:'Fortaleza, Brazil', lat:-3.7172, lon:-38.5431, scale:0.6},
{id:'manaus', name:'Manaus, Brazil', lat:-3.1190, lon:-60.0217, scale:0.6},
{id:'recife', name:'Recife, Brazil', lat:-8.0476, lon:-34.8770, scale:0.6},
{id:'porto_alegre', name:'Porto Alegre, Brazil', lat:-30.0346, lon:-51.2177, scale:0.6},
{id:'brasilia', name:'Brasília, Brazil', lat:-15.8267, lon:-47.9218, scale:0.7},
{id:'belgrade', name:'Belgrade, Serbia', lat:44.8176, lon:20.4569, scale:0.6},
{id:'sofia', name:'Sofia, Bulgaria', lat:42.6977, lon:23.3219, scale:0.6},
{id:'tirana', name:'Tirana, Albania', lat:41.3275, lon:19.8189, scale:0.5},
{id:'skopje', name:'Skopje, North Macedonia', lat:41.9981, lon:21.4254, scale:0.5},
{id:'pristina', name:'Pristina, Kosovo', lat:42.6629, lon:21.1655, scale:0.4},
{id:'sarajevo', name:'Sarajevo, Bosnia & Herzegovina', lat:43.8563, lon:18.4131, scale:0.5},
{id:'podgorica', name:'Podgorica, Montenegro', lat:42.4410, lon:19.2627, scale:0.4},
{id:'chisinau', name:'Chisinau, Moldova', lat:47.0105, lon:28.8638, scale:0.5},
{id:'minsk', name:'Minsk, Belarus', lat:53.9006, lon:27.5590, scale:0.6},
{id:'vilnius', name:'Vilnius, Lithuania', lat:54.6872, lon:25.2797, scale:0.5},
{id:'riga', name:'Riga, Latvia', lat:56.9496, lon:24.1052, scale:0.5},
{id:'tallinn', name:'Tallinn, Estonia', lat:59.4370, lon:24.7536, scale:0.5},
{id:'gdansk', name:'Gdańsk, Poland', lat:54.3520, lon:18.6466, scale:0.5},
{id:'krakow', name:'Kraków, Poland', lat:50.0647, lon:19.9450, scale:0.6},
{id:'poznan', name:'Poznań, Poland', lat:52.4064, lon:16.9252, scale:0.4},
{id:'wroclaw', name:'Wrocław, Poland', lat:51.1079, lon:17.0385, scale:0.5},
{id:'lviv', name:'Lviv, Ukraine', lat:49.8397, lon:24.0297, scale:0.5},
{id:'odesa', name:'Odesa, Ukraine', lat:46.4825, lon:30.7233, scale:0.5},
{id:'dnipro', name:'Dnipro, Ukraine', lat:48.4647, lon:35.0462, scale:0.5},
{id:'kharkiv', name:'Kharkiv, Ukraine', lat:49.9935, lon:36.2304, scale:0.6},
{id:'aleppo', name:'Aleppo, Syria', lat:36.2021, lon:37.1343, scale:0.5},
{id:'damascus', name:'Damascus, Syria', lat:33.5138, lon:36.2765, scale:0.6},
{id:'amman', name:'Amman, Jordan', lat:31.9496, lon:35.9329, scale:0.6},
{id:'doha', name:'Doha, Qatar', lat:25.2769, lon:51.5200, scale:0.7},
{id:'muscat', name:'Muscat, Oman', lat:23.5880, lon:58.3829, scale:0.6},
{id:'manama', name:'Manama, Bahrain', lat:26.2235, lon:50.5876, scale:0.5},
{id:'kuwait_city', name:'Kuwait City, Kuwait', lat:29.3759, lon:47.9774, scale:0.6},
{id:'medina', name:'Medina, Saudi Arabia', lat:24.5247, lon:39.5692, scale:0.6},
{id:'mecca', name:'Mecca, Saudi Arabia', lat:21.3891, lon:39.8579, scale:0.7},
{id:'jeddah', name:'Jeddah, Saudi Arabia', lat:21.4858, lon:39.1925, scale:0.7},
{id:'astana', name:'Astana, Kazakhstan', lat:51.1694, lon:71.4491, scale:0.6},
{id:'almaty', name:'Almaty, Kazakhstan', lat:43.2220, lon:76.8512, scale:0.6},
{id:'tashkent', name:'Tashkent, Uzbekistan', lat:41.2995, lon:69.2401, scale:0.6},
{id:'samarkand', name:'Samarkand, Uzbekistan', lat:39.6542, lon:66.9597, scale:0.5},
{id:'bishkek', name:'Bishkek, Kyrgyzstan', lat:42.8746, lon:74.5698, scale:0.5},
{id:'dushanbe', name:'Dushanbe, Tajikistan', lat:38.5598, lon:68.7870, scale:0.5},
{id:'ashgabat', name:'Ashgabat, Turkmenistan', lat:37.9601, lon:58.3261, scale:0.5},
{id:'tehran', name:'Tehran, Iran', lat:35.6892, lon:51.3890, scale:0.7},
{id:'isfahan', name:'Isfahan, Iran', lat:32.6539, lon:51.6660, scale:0.5},
{id:'shiraz', name:'Shiraz, Iran', lat:29.5918, lon:52.5837, scale:0.5},
{id:'tabriz', name:'Tabriz, Iran', lat:38.0962, lon:46.2738, scale:0.5},
{id:'mosul', name:'Mosul, Iraq', lat:36.3456, lon:43.1575, scale:0.5},
{id:'basra', name:'Basra, Iraq', lat:30.5080, lon:47.7835, scale:0.5},
{id:'erbil', name:'Erbil, Iraq', lat:36.1911, lon:44.0090, scale:0.5},
{id:'kabul', name:'Kabul, Afghanistan', lat:34.5553, lon:69.2075, scale:0.6},
{id:'herat', name:'Herat, Afghanistan', lat:34.3529, lon:62.2040, scale:0.4},
{id:'kandahar', name:'Kandahar, Afghanistan', lat:31.6289, lon:65.7372, scale:0.4},
{id:'lahore', name:'Lahore, Pakistan', lat:31.5497, lon:74.3436, scale:0.7},
{id:'karachi', name:'Karachi, Pakistan', lat:24.8607, lon:67.0011, scale:0.8},
{id:'islamabad', name:'Islamabad, Pakistan', lat:33.6844, lon:73.0479, scale:0.6},
{id:'peshawar', name:'Peshawar, Pakistan', lat:34.0150, lon:71.5805, scale:0.5},
{id:'quetta', name:'Quetta, Pakistan', lat:30.1798, lon:66.9750, scale:0.5},
{id:'dhaka', name:'Dhaka, Bangladesh', lat:23.8103, lon:90.4125, scale:0.7},
{id:'chittagong', name:'Chittagong, Bangladesh', lat:22.3569, lon:91.7832, scale:0.6},
{id:'sylhet', name:'Sylhet, Bangladesh', lat:24.8949, lon:91.8687, scale:0.4},
{id:'yangon', name:'Yangon, Myanmar', lat:16.8409, lon:96.1735, scale:0.6},
{id:'naypyidaw', name:'Naypyidaw, Myanmar', lat:19.7633, lon:96.0785, scale:0.4},
{id:'mandalay', name:'Mandalay, Myanmar', lat:21.9588, lon:96.0891, scale:0.5},
{id:'vientiane', name:'Vientiane, Laos', lat:17.9757, lon:102.6331, scale:0.5},
{id:'luang_prabang', name:'Luang Prabang, Laos', lat:19.8856, lon:102.1350, scale:0.3},
{id:'phnom_penh', name:'Phnom Penh, Cambodia', lat:11.5564, lon:104.9282, scale:0.6},
{id:'siem_reap', name:'Siem Reap, Cambodia', lat:13.3618, lon:103.8590, scale:0.4},
{id:'hue', name:'Hue, Vietnam', lat:16.4637, lon:107.5909, scale:0.4},
{id:'da_nang', name:'Da Nang, Vietnam', lat:16.0544, lon:108.2022, scale:0.5},
{id:'hanoi', name:'Hanoi, Vietnam', lat:21.0285, lon:105.8542, scale:0.7},
{id:'ho_chi_minh', name:'Ho Chi Minh City, Vietnam', lat:10.8231, lon:106.6297, scale:0.8},
{id:'bandar_seri_begawan', name:'Bandar Seri Begawan, Brunei', lat:4.9031, lon:114.9398, scale:0.4},
{id:'singapore', name:'Singapore, Singapore', lat:1.3521, lon:103.8198, scale:0.7},
{id:'kuala_lumpur', name:'Kuala Lumpur, Malaysia', lat:3.1390, lon:101.6869, scale:0.7},
{id:'george_town', name:'George Town, Malaysia', lat:5.4141, lon:100.3288, scale:0.5},
{id:'johor_bahru', name:'Johor Bahru, Malaysia', lat:1.4927, lon:103.7414, scale:0.5},
{id:'jakarta', name:'Jakarta, Indonesia', lat:-6.2088, lon:106.8456, scale:0.8},
{id:'bandung', name:'Bandung, Indonesia', lat:-6.9175, lon:107.6191, scale:0.6},
{id:'surabaya', name:'Surabaya, Indonesia', lat:-7.2575, lon:112.7521, scale:0.7},
{id:'medan', name:'Medan, Indonesia', lat:3.5952, lon:98.6722, scale:0.5},
{id:'denpasar', name:'Denpasar, Indonesia', lat:-8.6705, lon:115.2126, scale:0.5},
{id:'makassar', name:'Makassar, Indonesia', lat:-5.1477, lon:119.4327, scale:0.5},
{id:'manila', name:'Manila, Philippines', lat:14.5995, lon:120.9842, scale:0.8},
{id:'cebu', name:'Cebu, Philippines', lat:10.3157, lon:123.8854, scale:0.6},
{id:'davao', name:'Davao, Philippines', lat:7.1907, lon:125.4553, scale:0.5},
{id:'iloilo', name:'Iloilo, Philippines', lat:10.7202, lon:122.5621, scale:0.4},
{id:'baku', name:'Baku, Azerbaijan', lat:40.4093, lon:49.8671, scale:0.6},
{id:'yerevan', name:'Yerevan, Armenia', lat:40.1792, lon:44.4991, scale:0.6},
{id:'tbilisi', name:'Tbilisi, Georgia', lat:41.7151, lon:44.8271, scale:0.6},
{id:'addis_ababa', name:'Addis Ababa, Ethiopia', lat:9.0320, lon:38.7469, scale:0.6},
{id:'gondar', name:'Gondar, Ethiopia', lat:12.6100, lon:37.4600, scale:0.4},
{id:'dire_dawa', name:'Dire Dawa, Ethiopia', lat:9.6009, lon:41.8501, scale:0.4},
{id:'nairobi', name:'Nairobi, Kenya', lat:-1.2921, lon:36.8219, scale:0.7},
{id:'mombasa', name:'Mombasa, Kenya', lat:-4.0435, lon:39.6682, scale:0.5},
{id:'kampala', name:'Kampala, Uganda', lat:0.3476, lon:32.5825, scale:0.6},
{id:'entebbe', name:'Entebbe, Uganda', lat:0.0500, lon:32.4600, scale:0.3},
{id:'arusha', name:'Arusha, Tanzania', lat:-3.3869, lon:36.6822, scale:0.4},
{id:'dar_es_salaam', name:'Dar es Salaam, Tanzania', lat:-6.7924, lon:39.2083, scale:0.7},
{id:'dodoma', name:'Dodoma, Tanzania', lat:-6.1630, lon:35.7516, scale:0.4},
{id:'lusaka', name:'Lusaka, Zambia', lat:-15.3875, lon:28.3228, scale:0.5},
{id:'ndola', name:'Ndola, Zambia', lat:-12.9587, lon:28.6366, scale:0.4},
{id:'harare', name:'Harare, Zimbabwe', lat:-17.8292, lon:31.0522, scale:0.6},
{id:'bulawayo', name:'Bulawayo, Zimbabwe', lat:-20.1325, lon:28.6265, scale:0.4},
{id:'maputo', name:'Maputo, Mozambique', lat:-25.9692, lon:32.5732, scale:0.5},
{id:'beira', name:'Beira, Mozambique', lat:-19.8436, lon:34.8389, scale:0.4},
{id:'antananarivo', name:'Antananarivo, Madagascar', lat:-18.8792, lon:47.5079, scale:0.5},
{id:'moroni', name:'Moroni, Comoros', lat:-11.7172, lon:43.2473, scale:0.3},
{id:'victoria', name:'Victoria, Seychelles', lat:-4.6200, lon:55.4550, scale:0.3},
{id:'port_louis', name:'Port Louis, Mauritius', lat:-20.1669, lon:57.5020, scale:0.4},
{id:'antsirabe', name:'Antsirabe, Madagascar', lat:-19.8667, lon:47.0333, scale:0.3},
{id:'lagos', name:'Lagos, Nigeria', lat:6.5244, lon:3.3792, scale:0.8},
{id:'abuja', name:'Abuja, Nigeria', lat:9.0579, lon:7.4951, scale:0.6},
{id:'kano', name:'Kano, Nigeria', lat:12.0000, lon:8.5167, scale:0.5},
{id:'ibadan', name:'Ibadan, Nigeria', lat:7.3775, lon:3.9470, scale:0.5},
{id:'accra', name:'Accra, Ghana', lat:5.6037, lon:-0.1870, scale:0.6},
{id:'kumasi', name:'Kumasi, Ghana', lat:6.6666, lon:-1.6163, scale:0.4},
{id:'abidjan', name:'Abidjan, Côte d’Ivoire', lat:5.3453, lon:-4.0244, scale:0.6},
{id:'yamoussoukro', name:'Yamoussoukro, Côte d’Ivoire', lat:6.8161, lon:-5.2742, scale:0.4},
{id:'monrovia', name:'Monrovia, Liberia', lat:6.3000, lon:-10.7970, scale:0.4},
{id:'freetown', name:'Freetown, Sierra Leone', lat:8.4657, lon:-13.2317, scale:0.4},
{id:'dakar', name:'Dakar, Senegal', lat:14.7167, lon:-17.4677, scale:0.6},
{id:'bamako', name:'Bamako, Mali', lat:12.6392, lon:-8.0029, scale:0.5},
{id:'ouagadougou', name:'Ouagadougou, Burkina Faso', lat:12.3714, lon:-1.5197, scale:0.5},
{id:'niamey', name:'Niamey, Niger', lat:13.5116, lon:2.1254, scale:0.5},
{id:'conakry', name:'Conakry, Guinea', lat:9.6412, lon:-13.5784, scale:0.4},
{id:'bissau', name:'Bissau, Guinea-Bissau', lat:11.8613, lon:-15.5830, scale:0.3},
{id:'banjul', name:'Banjul, Gambia', lat:13.4549, lon:-16.5790, scale:0.3},
{id:'nouakchott', name:'Nouakchott, Mauritania', lat:18.0735, lon:-15.9582, scale:0.4},
{id:'casablanca', name:'Casablanca, Morocco', lat:33.5731, lon:-7.5898, scale:0.6},
{id:'marrakech', name:'Marrakech, Morocco', lat:31.6295, lon:-7.9811, scale:0.5},
{id:'fes', name:'Fes, Morocco', lat:34.0181, lon:-5.0078, scale:0.4},
{id:'rabat', name:'Rabat, Morocco', lat:34.0209, lon:-6.8416, scale:0.5},
{id:'algiers', name:'Algiers, Algeria', lat:36.7538, lon:3.0588, scale:0.6},
{id:'oran', name:'Oran, Algeria', lat:35.6971, lon:-0.6308, scale:0.5},
{id:'constantine', name:'Constantine, Algeria', lat:36.3650, lon:6.6147, scale:0.4},
{id:'tunis', name:'Tunis, Tunisia', lat:36.8065, lon:10.1815, scale:0.6},
{id:'sousse', name:'Sousse, Tunisia', lat:35.8256, lon:10.6411, scale:0.4},
{id:'tripoli', name:'Tripoli, Libya', lat:32.8872, lon:13.1913, scale:0.6},
{id:'benghazi', name:'Benghazi, Libya', lat:32.1167, lon:20.0667, scale:0.4},
{id:'khartoum', name:'Khartoum, Sudan', lat:15.5007, lon:32.5599, scale:0.6},
{id:'omdurman', name:'Omdurman, Sudan', lat:15.6500, lon:32.4833, scale:0.4},
{id:'juba', name:'Juba, South Sudan', lat:4.8594, lon:31.5713, scale:0.5},
{id:'pretoria', name:'Pretoria, South Africa', lat:-25.7479, lon:28.2293, scale:0.6},
{id:'johannesburg', name:'Johannesburg, South Africa', lat:-26.2041, lon:28.0473, scale:0.7},
{id:'cape_town', name:'Cape Town, South Africa', lat:-33.9249, lon:18.4241, scale:0.7},
{id:'durban', name:'Durban, South Africa', lat:-29.8587, lon:31.0218, scale:0.6},
{id:'bloemfontein', name:'Bloemfontein, South Africa', lat:-29.0852, lon:26.1596, scale:0.4},
{id:'windhoek', name:'Windhoek, Namibia', lat:-22.5597, lon:17.0832, scale:0.5},
{id:'gaborone', name:'Gaborone, Botswana', lat:-24.6282, lon:25.9231, scale:0.4},
{id:'maseru', name:'Maseru, Lesotho', lat:-29.3167, lon:27.4833, scale:0.3},
{id:'mbabane', name:'Mbabane, Eswatini', lat:-26.3054, lon:31.1367, scale:0.3},
{id:'antwerp', name:'Antwerp, Belgium', lat:51.2194, lon:4.4025, scale:0.5},
{id:'brussels', name:'Brussels, Belgium', lat:50.8503, lon:4.3517, scale:0.6},
{id:'rotterdam', name:'Rotterdam, Netherlands', lat:51.9225, lon:4.4792, scale:0.5},
{id:'amsterdam', name:'Amsterdam, Netherlands', lat:52.3676, lon:4.9041, scale:0.7},
{id:'the_hague', name:'The Hague, Netherlands', lat:52.0705, lon:4.3007, scale:0.5},
{id:'zurich', name:'Zurich, Switzerland', lat:47.3769, lon:8.5417, scale:0.6},
{id:'geneva', name:'Geneva, Switzerland', lat:46.2044, lon:6.1432, scale:0.6},
{id:'basel', name:'Basel, Switzerland', lat:47.5596, lon:7.5886, scale:0.5},
{id:'bern', name:'Bern, Switzerland', lat:46.9481, lon:7.4474, scale:0.5},
{id:'munich', name:'Munich, Germany', lat:48.1351, lon:11.5820, scale:0.7},
{id:'hamburg', name:'Hamburg, Germany', lat:53.5511, lon:9.9937, scale:0.7},
{id:'frankfurt', name:'Frankfurt, Germany', lat:50.1109, lon:8.6821, scale:0.7},
{id:'stuttgart', name:'Stuttgart, Germany', lat:48.7758, lon:9.1829, scale:0.6},
{id:'cologne', name:'Cologne, Germany', lat:50.9375, lon:6.9603, scale:0.6},
{id:'dresden', name:'Dresden, Germany', lat:51.0504, lon:13.7373, scale:0.5},
{id:'leipzig', name:'Leipzig, Germany', lat:51.3397, lon:12.3731, scale:0.5},
{id:'essen', name:'Essen, Germany', lat:51.4556, lon:7.0116, scale:0.5},
// --- Europe & Central Asia ---
{id:'minsk', name:'Minsk, Belarus', lat:53.9006, lon:27.5590, scale:0.5},
{id:'vilnius', name:'Vilnius, Lithuania', lat:54.6872, lon:25.2797, scale:0.5},
{id:'riga', name:'Riga, Latvia', lat:56.9496, lon:24.1052, scale:0.5},
{id:'tallinn', name:'Tallinn, Estonia', lat:59.4370, lon:24.7536, scale:0.5},
{id:'chisinau', name:'Chișinău, Moldova', lat:47.0105, lon:28.8638, scale:0.4},
{id:'bratislava', name:'Bratislava, Slovakia', lat:48.1486, lon:17.1077, scale:0.5},
{id:'ljubljana', name:'Ljubljana, Slovenia', lat:46.0569, lon:14.5058, scale:0.4},
{id:'sarajevo', name:'Sarajevo, Bosnia & Herzegovina', lat:43.8563, lon:18.4131, scale:0.4},
{id:'podgorica', name:'Podgorica, Montenegro', lat:42.4410, lon:19.2627, scale:0.4},
{id:'tirana', name:'Tirana, Albania', lat:41.3275, lon:19.8189, scale:0.4},
{id:'pristina', name:'Pristina, Kosovo', lat:42.6629, lon:21.1655, scale:0.4},
{id:'yerevan', name:'Yerevan, Armenia', lat:40.1792, lon:44.4991, scale:0.5},
{id:'tbilisi', name:'Tbilisi, Georgia', lat:41.7151, lon:44.8271, scale:0.5},
{id:'baku', name:'Baku, Azerbaijan', lat:40.4093, lon:49.8671, scale:0.6},
{id:'astana', name:'Astana, Kazakhstan', lat:51.1694, lon:71.4491, scale:0.6},
{id:'almaty', name:'Almaty, Kazakhstan', lat:43.2220, lon:76.8512, scale:0.6},
{id:'bishkek', name:'Bishkek, Kyrgyzstan', lat:42.8746, lon:74.5698, scale:0.5},
{id:'dushanbe', name:'Dushanbe, Tajikistan', lat:38.5598, lon:68.7870, scale:0.4},
{id:'ashgabat', name:'Ashgabat, Turkmenistan', lat:37.9601, lon:58.3261, scale:0.4},
{id:'tashkent', name:'Tashkent, Uzbekistan', lat:41.2995, lon:69.2401, scale:0.6},

// --- Middle East & North Africa ---
{id:'manama', name:'Manama, Bahrain', lat:26.2285, lon:50.5860, scale:0.4},
{id:'muscat', name:'Muscat, Oman', lat:23.5880, lon:58.3829, scale:0.5},
{id:'sanaa', name:'Sana’a, Yemen', lat:15.3694, lon:44.1910, scale:0.5},
{id:'aden', name:'Aden, Yemen', lat:12.7855, lon:45.0187, scale:0.4},
{id:'beirut', name:'Beirut, Lebanon', lat:33.8938, lon:35.5018, scale:0.5},
{id:'amman', name:'Amman, Jordan', lat:31.9539, lon:35.9106, scale:0.6},
{id:'damascus', name:'Damascus, Syria', lat:33.5138, lon:36.2765, scale:0.5},
{id:'aleppo', name:'Aleppo, Syria', lat:36.2021, lon:37.1343, scale:0.4},
{id:'tehran', name:'Tehran, Iran', lat:35.6892, lon:51.3890, scale:0.8},
{id:'mashhad', name:'Mashhad, Iran', lat:36.2605, lon:59.6168, scale:0.6},
{id:'isfahan', name:'Isfahan, Iran', lat:32.6546, lon:51.6680, scale:0.6},
{id:'shiraz', name:'Shiraz, Iran', lat:29.5918, lon:52.5837, scale:0.5},
{id:'tabriz', name:'Tabriz, Iran', lat:38.0962, lon:46.2738, scale:0.5},
{id:'karbala', name:'Karbala, Iraq', lat:32.6160, lon:44.0246, scale:0.4},
{id:'najaf', name:'Najaf, Iraq', lat:32.0000, lon:44.3300, scale:0.4},
{id:'basra', name:'Basra, Iraq', lat:30.5085, lon:47.7804, scale:0.5},
{id:'mosul', name:'Mosul, Iraq', lat:36.3456, lon:43.1575, scale:0.5},
{id:'haifa', name:'Haifa, Israel', lat:32.7940, lon:34.9896, scale:0.5},
{id:'tel_aviv', name:'Tel Aviv, Israel', lat:32.0853, lon:34.7818, scale:0.6},
{id:'jerusalem', name:'Jerusalem, Israel/Palestine', lat:31.7683, lon:35.2137, scale:0.7},

// --- Extra Africa (North & Horn) ---
{id:'addis_ababa', name:'Addis Ababa, Ethiopia', lat:9.0192, lon:38.7525, scale:0.7},
{id:'djibouti', name:'Djibouti City, Djibouti', lat:11.8251, lon:42.5903, scale:0.4},
{id:'asmara', name:'Asmara, Eritrea', lat:15.3229, lon:38.9251, scale:0.4},
{id:'nouakchott', name:'Nouakchott, Mauritania', lat:18.0735, lon:-15.9582, scale:0.4},
{id:'bamako', name:'Bamako, Mali', lat:12.6392, lon:-8.0029, scale:0.5},
{id:'ouagadougou', name:'Ouagadougou, Burkina Faso', lat:12.3714, lon:-1.5197, scale:0.5},
{id:'lome', name:'Lomé, Togo', lat:6.1375, lon:1.2123, scale:0.4},
{id:'cotonou', name:'Cotonou, Benin', lat:6.3703, lon:2.3912, scale:0.4},
{id:'niamey', name:'Niamey, Niger', lat:13.5128, lon:2.1126, scale:0.4},
{id:'conakry', name:'Conakry, Guinea', lat:9.6412, lon:-13.5784, scale:0.5},
{id:'freetown', name:'Freetown, Sierra Leone', lat:8.4657, lon:-13.2317, scale:0.4},
{id:'monrovia', name:'Monrovia, Liberia', lat:6.3156, lon:-10.8074, scale:0.4},
  {id:'manama2', name:'Manama (alt), Bahrain', lat:26.2235, lon:50.5876, scale:0.2}
];

  // For performance: number of points per city roughly proportional to scale (tweakable)
  function pointsForCity(scale){
    // baseline ~220 points for scale 1.0
    return Math.round(120 + 200 * scale); // range ~ 240 - 520
  }

  // POI types and base radius (meters)
  const POI_TYPES = [
    {key:'hospital', base:300},
    {key:'market', base:400},
    {key:'pharmacy', base:60},
    {key:'school', base:200},
    {key:'transit', base:120},
    {key:'industrial', base:500},
    {key:'atm', base:30},
    {key:'farm', base:600}
  ];

  // ---------- Deterministic seeded RNG for reproducible map ----------
  function mulberry32(a){ return function(){ var t = a += 0x6D2B79F5; t = Math.imul(t ^ t>>>15, t | 1); t ^= t + Math.imul(t ^ t>>>7, t | 61); return ((t ^ t>>>14) >>> 0) / 4294967296; } }
  const rng = mulberry32(987654321);

  // ---------- Utility helpers ----------
  function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
  function lerpColor(c1,c2,t){ return `rgb(${Math.round(c1[0]+(c2[0]-c1[0])*t)},${Math.round(c1[1]+(c2[1]-c1[1])*t)},${Math.round(c1[2]+(c2[2]-c1[2])*t)})`; }
  function colorForPercent(p){
    p = clamp(p,0,100);
    if (p <= 50){
      const t = p/50; return lerpColor([76,175,80],[255,193,7],t);
    } else {
      const t = (p-50)/50; return lerpColor([255,193,7],[244,67,54],t);
    }
  }

  // ---------- Factor score heuristics ----------
  function popProxy(lat, lon){
    // simple proxy: higher for large land masses and moderate latitudes, deterministic via coords
    const latFactor = 1 - Math.abs(lat)/90; // 1 at equator -> 0 at poles
    const noise = (Math.abs(Math.sin(lat*127.1 + lon*311.7)) + Math.abs(Math.cos(lon*13.7 - lat*7.3)))/4;
    const base = clamp(0.2 + 0.8 * clamp(latFactor,0,1) * (0.5 + noise*0.5), 0,1);
    return base;
  }

  // Compute factor scores for a generated POI
  function computeFactorScores(type, lat, lon){
    const pop = popProxy(lat, lon); // 0-1
    const scores = {};
    scores.pop_density = clamp(pop * (0.6 + rng()*0.8), 0,1);
    scores.pharmacy_density = clamp(pop * (0.3 + rng()*0.9), 0,1);
    scores.hospital_effluent = (type==='hospital') ? clamp(0.6 + rng()*0.4,0,1) : clamp(rng()*0.3,0,1);
    scores.sewage_coverage = clamp(1 - (0.3 + rng()*0.6)*pop, 0,1); // higher -> worse
    scores.industrial_effluent = (type==='industrial') ? clamp(0.6 + rng()*0.4,0,1) : clamp(rng()*0.25,0,1);
    scores.veterinary_farms = (type==='farm') ? clamp(0.6 + rng()*0.4,0,1) : clamp(rng()*0.25,0,1);
    scores.socioeconomic = clamp(0.2 + 0.8*(1 - pop) * (0.6 + rng()*0.8), 0,1); // higher -> better socio (we will invert later)
    scores.prescription = clamp(0.4 + rng()*0.6, 0,1);
    scores.drainage = clamp(1 - (0.3 + rng()*0.6)*(1 - scores.socioeconomic), 0,1); // higher -> worse
    scores.water_stagnation = clamp(0.2 + 0.7*(1 - scores.socioeconomic)*rng(), 0,1);
    scores.livestock_market = (type==='farm' || type==='market') ? clamp(0.5 + rng()*0.5,0,1) : clamp(rng()*0.2,0,1);
    scores.manure_use = clamp(0.1 + 0.8 * scores.veterinary_farms * rng(), 0,1);
    return scores;
  }

  // Compute multiplier using weights and scores
  function computeMultiplier(scores){
    let sum = 0;
    for (const f of FACTORS){
      const sscore = (f.id in scores) ? scores[f.id] : 0.5;
      let useScore = sscore;
      if (f.id === 'socioeconomic') useScore = 1 - sscore; // inverse
      sum += f.weight * (useScore - 0.5);
    }
    const multiplier = 1 + ALPHA * sum;
    return {multiplier:multiplier, sum:sum};
  }

  // Compute radius_m for POI (strict caps to ensure locality)
  function computeRadius(type, pop, effluentScore, sizeProxy){
    // base mapping
    let base = 120;
    const map = {'hospital':300,'market':400,'pharmacy':60,'school':200,'transit':120,'industrial':500,'atm':30,'farm':600};
    base = map[type] || 120;
    const pop_scale = 0.6, eff_scale = 0.8;
    let r = base * (1 + pop*pop_scale) * (1 + effluentScore*eff_scale);
    if (sizeProxy && sizeProxy > 0) r *= 1 + Math.log10(sizeProxy+1)*0.12;
    r = clamp(r, 10, 1200);
    return Math.round(r);
  }

  // ---------- Generate points for all cities ----------
  const zones = []; // each {id, city, type, center:[lat,lon], radius_m, factors, resistances}
  let globalCounter = 0;

  for (const city of CITIES){
    const n = pointsForCity(city.scale);
    // generate points randomly within ~R km box around city center (use degrees approx)
    const lat0 = city.lat, lon0 = city.lon;
    // approximate spread degrees for city extent depending on scale
    const degSpread = 0.06 * (1 + city.scale*1.8); // ~0.06 degrees ~6-7 km base
    for (let i=0;i<n;i++){
      // pick a POI type weighted: hospitals fewer, markets/pharmacy more
      const typeChoice = (() => {
        const r = rng();
        if (r < 0.06) return 'hospital';
        if (r < 0.20) return 'market';
        if (r < 0.34) return 'pharmacy';
        if (r < 0.48) return 'school';
        if (r < 0.62) return 'transit';
        if (r < 0.72) return 'industrial';
        if (r < 0.86) return 'atm';
        return 'farm';
      })();

      // random offset within city box (uniform)
      const lat = lat0 + (rng()*2 - 1) * degSpread;
      const lon = lon0 + (rng()*2 - 1) * degSpread * Math.cos(lat0 * Math.PI / 180);
      const factors = computeFactorScores(typeChoice, lat, lon);
      const m = computeMultiplier(factors);
      const resistances = {};
      for (const a in BASELINE) {
        const adjusted = clamp( Math.round((BASELINE[a] * m.multiplier) * 10) / 10, 0, 100);
        resistances[a] = adjusted;
      }
      const sizeProxy = Math.floor(1 + rng()*200); // small size proxy (e.g., bed count or footfall)
      const radius_m = computeRadius(typeChoice, factors.pop_density, factors.hospital_effluent + factors.industrial_effluent, sizeProxy);
      zones.push({
        id: `zone_${globalCounter++}`,
        city: city.id,
        cityName: city.name,
        type: typeChoice,
        center: [lat, lon],
        radius_m: radius_m,
        factors: factors,
        resistances: resistances,
        sizeProxy: sizeProxy
      });
    }
  }

  // ---------- Map initialization ----------
  const map = L.map('map', { renderer: L.canvas({ padding:0.5 }), preferCanvas:true }).setView([20,0], 2);

  // OSM tiles
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors',
    maxZoom: 19
  }).addTo(map);

  // ---------- Create canvas circles for zones ----------
  // We will create Leaflet circles (they will render to canvas due to renderer option)
  const circleRefs = []; // store {zone, circle, currentValue}
  let currentAnt = 'cip';
  let currentYear = 0;

  function drawAllZones(){
    // remove old circles
    for (const r of circleRefs) { map.removeLayer(r.circle); }
    circleRefs.length = 0;

    for (const z of zones){
      // incorporate year effect (linear small increment)
      const baseVal = z.resistances[currentAnt];
      const val = clamp(Math.round((baseVal + currentYear * YEARLY_INCREASE) * 10)/10, 0, 100);
      const col = colorForPercent(val);

      // Draw circle with radius in meters
      const circle = L.circle(z.center, {
        radius: Math.max(8, Math.min(z.radius_m, 350000)), // keep visibility sensible
        color: col,
        fillColor: col,
        fillOpacity: 0.55,
        weight: 0.6,
        renderer: map.options.renderer
      });

      // popup content computed lazily
      circle.on('click', ()=> {
        const comp = computePopupData(z);
        const popup = L.popup({ maxWidth: 320 }).setLatLng(z.center).setContent(comp.html);
        popup.openOn(map);
        // optionally open Street View panel if key supplied
        if (GOOGLE_MAPS_API_KEY) showStreetView(z.center);
      });

      circle.addTo(map);
      circleRefs.push({zone:z, circle:circle, value:val});
    }
  }

  function computePopupData(z){
    // recompute resistances with year
    const all = {};
    for (const k in z.resistances){
      all[k] = clamp(Math.round((z.resistances[k] + currentYear * YEARLY_INCREASE)*10)/10,0,100);
    }
    // compute contributions
    const contribs = [];
    for (const f of FACTORS){
      let s = z.factors[f.id] ?? 0.5;
      if (f.id === 'socioeconomic') s = 1 - s;
      const contribution = f.weight * (s - 0.5) * ALPHA * 100; // percent points approximation
      contribs.push({label:f.label, score:(z.factors[f.id] ?? 0.5).toFixed(2), contribution: Math.round(contribution*10)/10});
    }
    contribs.sort((a,b)=>Math.abs(b.contribution) - Math.abs(a.contribution));
    const top = contribs.slice(0,4);

    // popup html
    let html = `<div style="min-width:220px"><div style="font-weight:700">${z.cityName} — ${z.type.toUpperCase()}</div>`;
    html += `<div style="font-size:12px;color:var(--muted); margin-bottom:6px;">Lat: ${z.center[0].toFixed(4)}, Lon: ${z.center[1].toFixed(4)} • Radius: ${z.radius_m} m</div>`;
    html += `<table style="width:100%; font-size:13px; color:${getComputedStyle(document.documentElement).getPropertyValue('--text')};">`;
    html += `<tr><td style="padding:4px 0">Ciprofloxacin</td><td style="text-align:right">${all.cip}%</td></tr>`;
    html += `<tr><td style="padding:4px 0">Amoxicillin</td><td style="text-align:right">${all.amox}%</td></tr>`;
    html += `<tr><td style="padding:4px 0">Tetracycline</td><td style="text-align:right">${all.tetra}%</td></tr>`;
    html += `<tr><td style="padding:4px 0">Gentamicin</td><td style="text-align:right">${all.gent}%</td></tr>`;
    html += `<tr><td style="padding:4px 0">Erythromycin</td><td style="text-align:right">${all.eryth}%</td></tr>`;
    html += `</table>`;
    html += `<div style="font-size:12px;color:var(--muted); margin-top:8px;"><strong>Top contributing factors</strong></div>`;
    for (const t of top){
      html += `<div style="font-size:12px; margin-top:4px;"><span style="display:inline-block; width:150px;">${t.label}</span><span style="float:right;">${t.contribution} pp</span></div>`;
    }
    html += `<div style="font-size:11px;color:var(--muted); margin-top:8px;">(Simulated — model estimates)</div></div>`;
    return { html, top };
  }

  // initial draw
  drawAllZones();

  // ---------- UI wiring ----------
  const antibDiv = document.getElementById('antibtns');
  ANTIBIOTICS.forEach(a=>{
    const btn = document.createElement('button');
    btn.className = 'ant-btn' + (a.key==='cip' ? ' active' : '');
    btn.textContent = a.label;
    btn.dataset.key = a.key;
    btn.onclick = () => {
      document.querySelectorAll('.ant-btn').forEach(x=>x.classList.remove('active'));
      btn.classList.add('active');
      currentAnt = a.key;
      drawAllZones();
    };
    antibDiv.appendChild(btn);
  });

  // year slider
  document.getElementById('yearSlider').oninput = (e)=>{
    currentYear = parseInt(e.target.value,10);
    document.getElementById('yearLabel').innerText = 'Year: ' + currentYear;
    drawAllZones();
  };

  // run story tour (zoom to a handful of demo cities)
  document.getElementById('runStory').onclick = async function(){
    const demoPlaces = [
      {lat:28.7041, lon:77.1025, z:7}, // Delhi
      {lat:40.7128, lon:-74.0060, z:6}, // NY
      {lat:51.5074, lon:-0.1278, z:6}, // London
      {lat:-23.5505, lon:-46.6333, z:6}, // Sao Paulo
      {lat:35.6762, lon:139.6503, z:6} // Tokyo
    ];
    for (const p of demoPlaces){
      map.flyTo([p.lat, p.lon], p.z, {animate:true, duration:1.4});
      // highlight nearby circles: increase opacity for those within 0.5 degrees
      circleRefs.forEach(cr=>{
        const dz = Math.abs(cr.zone.center[0] - p.lat) + Math.abs(cr.zone.center[1] - p.lon);
        if (dz < 2.0) {
          cr.circle.setStyle({fillOpacity:0.95, weight:1.2});
        } else {
          cr.circle.setStyle({fillOpacity:0.08});
        }
      });
      await new Promise(r=>setTimeout(r, 1600));
    }
    // restore
    drawAllZones();
    map.setView([20,0], 2);
  };

  // reset map
  document.getElementById('resetMap').onclick = function(){
    currentYear = 0; document.getElementById('yearSlider').value = 0; document.getElementById('yearLabel').innerText='Year: 0';
    drawAllZones(); map.setView([20,0],2);
  };

  // language toggle (minimal)
  let lang = 'en';
  const strings = { en:{run:'Run Tour', reset:'Reset Map'}, hi:{run:'दिखाएँ', reset:'रीसेट मैप'} };
  document.getElementById('langToggle').onclick = function(){
    lang = (lang==='en' ? 'hi' : 'en');
    document.getElementById('runStory').innerText = strings[lang].run;
    document.getElementById('resetMap').innerText = strings[lang].reset;
  };

  // click on map to open nearest zone popup if close
  map.on('click', function(e){
    let nearest=null, mind=Infinity;
    for (const z of zones){
      const d = map.distance(e.latlng, L.latLng(z.center));
      if (d < mind){ mind=d; nearest=z; }
    }
    if (nearest && mind <= nearest.radius_m * 1.2){
      const popup = L.popup({ maxWidth:320 }).setLatLng(nearest.center).setContent(computePopupData(nearest).html);
      popup.openOn(map);
      if (GOOGLE_MAPS_API_KEY) showStreetView(nearest.center);
    }
  });

  // keep map responsive
  window.addEventListener('resize', ()=> setTimeout(()=>map.invalidateSize(), 200));

  // ---------- Optional Street View integration (Google Maps JS) ----------
  // If you supply an API key at top, we dynamically load Maps JS and try to open Street View when a zone is clicked.
  let streetViewService = null;
  let streetViewPanorama = null;
  function loadGoogleMapsIfNeeded(){
    if (!GOOGLE_MAPS_API_KEY) return;
    if (window.google && google.maps) { initStreetView(); return; }
    const s = document.createElement('script');
    s.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_MAPS_API_KEY}&libraries=&v=weekly`;
    s.defer = true; s.async = true;
    s.onload = initStreetView;
    document.head.appendChild(s);
  }
  function initStreetView(){
    if (!window.google || !google.maps) return;
    streetViewService = new google.maps.StreetViewService();
    // create a floating panel for panorama
    const panel = document.createElement('div');
    panel.id = 'svPanel';
    panel.style.position = 'absolute';
    panel.style.right = '12px';
    panel.style.top = '12px';
    panel.style.zIndex = 5000;
    panel.style.width = '360px';
    panel.style.height = '300px';
    panel.style.borderRadius = '8px';
    panel.style.boxShadow = '0 8px 20px rgba(0,0,0,0.6)';
    panel.style.overflow='hidden';
    panel.style.display='none';
    panel.style.background='#000';
    document.body.appendChild(panel);
    streetViewPanorama = new google.maps.StreetViewPanorama(panel, { addressControl:false, linksControl:false, panControl:false, zoomControl:false, enableCloseButton:true });
    // allow close on click outside
    document.addEventListener('click', (ev)=>{
      if (!panel.contains(ev.target) && panel.style.display==='block'){
        panel.style.display='none';
      }
    });
  }

  function showStreetView(latlon){
    if (!GOOGLE_MAPS_API_KEY) return;
    if (!streetViewService) loadGoogleMapsIfNeeded();
    if (!streetViewService) return;
    const latLng = new google.maps.LatLng(latlon[0], latlon[1]);
    streetViewService.getPanorama({ location: latLng, radius: 200 }, (data, status) => {
      if (status === google.maps.StreetViewStatus.OK && data && data.location){
        const panel = document.getElementById('svPanel');
        if (!panel) return;
        panel.style.display = 'block';
        panel.style.width = '420px';
        panel.style.height = '340px';
        // set panorama
        streetViewPanorama.setPano(data.location.pano);
        streetViewPanorama.setVisible(true);
      } else {
        // not available; no-op
      }
    });
  }

  // Load Google Maps only if key present (deferred)
  if (GOOGLE_MAPS_API_KEY) loadGoogleMapsIfNeeded();

  </script>
</body>
</html>
